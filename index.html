<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat.AL</title>
    <!-- Google Fonts Embed -->
    <link href="https://fonts.googleapis.com/css2?family=Tiny5&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: black;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            border: 2px solid black; /* Border around the entire content */
            padding: 20px; /* Padding to ensure content doesn't touch the border */
        }
        img {
            width: 320px;
            height: 320px;
            margin-bottom: -35px;
        }

        /* HEADER */
        h1 {
            margin-bottom: 0px;
            font-family: 'Tiny5', Courier, monospace;
            font-size: 50pt;
            font-weight: normal;
        }

        /* SUBHEADER */
        h2 {
            margin-top: 0px;
            margin-bottom: 20px;
            font-family: 'Tiny5', Courier, monospace;
            font-size: 20pt;
            font-weight: normal;
        }
        input[type="text"] {
            padding: 10px;
            border: none;
            border-radius: 5px;
            margin-bottom: 10px;
            width: 300px;
            text-align: center;
            font-size: 20px;
        }

        /* BUTTON CONTAINER */
        .button-container {
            display: flex;
            justify-content: center; /* Center items horizontally */
            width: 100%; /* Full width to center button */
            margin-top: 10px;
        }

        /* GEN BUTTON */
        button {
            margin: 0 10px; /* Space between buttons */
            padding: 5px 20px; /* Adjust padding for better vertical alignment */
            border: 2px solid transparent; /* Default border for non-regenerate button */
            border-radius: 5px;
            background-color: white; /* Generate button color */
            color: black;
            cursor: pointer;
            font-size: 16px;
            height: 35px; /* Ensure button height matches the icon */
            width: 150px; /* Consistent width */
            display: flex; /* Use flex to align text */
            align-items: center; /* Center text vertically */
            justify-content: center; /* Center text horizontally */
            line-height: 1; /* Ensure line-height doesn't affect alignment */
        }

        /* REGEN BUTTON */
        button.regenerate {
            background-color: black; /* Regenerate button color */
            color: white;
            border: 2px solid white;
        }

        button:disabled {
            cursor: not-allowed;
        }
        button:hover:not(:disabled) {
            opacity: 1;
        }

        /* AUDIO ICON */
        .audio-icon {
            width: 30px; /* Width of the icon */
            height: 30px; /* Height of the icon */
            cursor: pointer;
            margin-top: 10px; /* Margin top to place below the response area */
        }

        /* RESPONSE CONTAINER */
        .response-signature-container {
            width: 320px; /* Adjust width to 320px */
            height: 200px; /* Adjust height to 200px */
            margin-top: 22px;
            border: 2px solid white; /* White border around the container */
            border-radius: 5px;
            background-color: black; /* Black fill for the container */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px; /* Padding inside the container */
            box-sizing: border-box; /* Include padding in the container's width and height */
            overflow: hidden; /* Hide overflow to ensure text scales properly */
        }

        /* RESPONSE TEXT */
        .response {
            text-align: center;
            font-family: 'Comic Sans MS', cursive, sans-serif; /* Comic Sans italic */
            font-style: italic;
            margin: 0; /* Remove margin to prevent overflow */
            padding: 0;
            line-height: 1.2; /* Adjust line-height for better readability */
        }

        /* AUDIO CONTAINER */
        .audio-container {
            display: flex;
            justify-content: center; /* Center the audio icon */
            width: 100%;
            margin-top: 10px; /* Space above the audio icon */
        }
    </style>
</head>
<body>
    <img src="FACE.png" alt="Image" id="topImage">
    <h1>Chat.AL</h1>
    <h2>Your Alan AI Assistance.</h2>
    <input type="text" id="question" placeholder="Type your question here" oninput="checkInput()" onkeydown="checkEnter(event)">
    <div class="button-container">
        <button id="submitBtn" onclick="getResponse()">Generate</button>
    </div>
    <div class="response-signature-container">
        <p id="response" class="response"></p>
    </div>
    <div class="audio-container">
        <img src="Audio_ON.svg" alt="Audio Icon" class="audio-icon" id="audioToggle" onclick="toggleAudio()">
    </div>

    <script>
        let typing = false; // Track whether typing is in progress
        let audioEnabled = true; // Audio is enabled by default
        let currentWord = ""; // To store the current word being typed
        let lastResponse = ""; // Store the last response

        function checkEnter(event) {
            if (event.key === "Enter") {
                getResponse();
            }
        }

        function checkInput() {
            const inputField = document.getElementById("question");
            const submitButton = document.getElementById("submitBtn");

            // Reset the button text to "Generate" if the input field is blank or contains only spaces
            if (inputField.value.trim() === "") {
                submitButton.textContent = "Generate";
                submitButton.classList.remove('regenerate');
            }
        }

        function getResponse() {
            const inputField = document.getElementById("question");
            const submitButton = document.getElementById("submitBtn");

            // Do nothing if the input is blank or only contains spaces
            if (inputField.value.trim() === "" || typing) {
                return;
            }

            // Disable the button to prevent multiple clicks
            submitButton.disabled = true;
            submitButton.textContent = "Loading"; // Change button text to "Loading"

            const responses = [
                "Wouldn't you like to know.",
                "Did you try to restart your computer?",
                "I'm not feeling it right now, can you ask again?",
                "I'm pretty sure you know the answer.",
                "I'll get back to you in 5 minutes to an hour.",
                "Oh we both know you know.",
                "Did you try googling it?",
                "When was the last time you flossed?",
                "Yes, Jean-Claude Van Damme can still do the splits at the age of 63.",
                "Error, Error, Error, *cough*, Error.",
                "Sorry I need to go to the bathroom, I'll get back to you later.",
                "The answer might be more complicated than it seems."
            ];

            let randomIndex;
            let randomResponse;

            // Ensure the new response is different from the last one
            do {
                randomIndex = Math.floor(Math.random() * responses.length);
                randomResponse = responses[randomIndex];
            } while (randomResponse === lastResponse);

            // Update lastResponse to the new one
            lastResponse = randomResponse;

            // Clear the previous response before typing the new one
            document.getElementById("response").textContent = "";
            typing = true;
            currentWord = ""; // Reset the current word

            // Change the image to the talking GIF
            document.getElementById("topImage").src = "FACE_Talk.gif";

            typeLetterByLetter(randomResponse, 0, () => {
                // After typing is complete, enable the button
                document.getElementById("submitBtn").disabled = false;
                document.getElementById("submitBtn").textContent = "Regenerate";
                document.getElementById("submitBtn").classList.add('regenerate');
                typing = false;
                adjustFontSize(); // Adjust font size after typing is done
                
                // Revert the image back to the original static face
                document.getElementById("topImage").src = "FACE.png";
            });
        }

        function typeLetterByLetter(text, i, callback) {
            if (i < text.length) {
                const currentChar = text.charAt(i);
                document.getElementById("response").textContent += currentChar;
                currentWord += currentChar;

                // Check if the current character is a space or punctuation, which indicates the end of a word
                if (currentChar === ' ' || i === text.length - 1 || [',', '.', '!', '?'].includes(currentChar)) {
                    // Exclude quotation marks from the spoken text
                    const spokenText = currentWord.trim().replace(/^"|"$/g, '');
                    speakText(spokenText);
                    currentWord = ""; // Reset the current word
                }

                setTimeout(() => typeLetterByLetter(text, i + 1, callback), 100);
            } else if (callback) {
                callback();
            }
        }

        function speakText(text) {
            if (audioEnabled) {
                const utterance = new SpeechSynthesisUtterance(text);
                speechSynthesis.speak(utterance);
            }
        }

        function toggleAudio() {
            audioEnabled = !audioEnabled;
            const audioIcon = document.getElementById("audioToggle");
            audioIcon.src = audioEnabled ? "Audio_ON.svg" : "Audio_OFF.svg";
        }

        function adjustFontSize() {
            const responseContainer = document.querySelector('.response-signature-container');
            const responseText = document.getElementById('response');

            let fontSize = 20; // Starting font size in points
            responseText.style.fontSize = fontSize + "pt"; // Set initial font size

            // Decrease font size until text fits within the container
            while (responseText.scrollHeight > responseContainer.clientHeight && fontSize > 12) {
                fontSize--;
                responseText.style.fontSize = fontSize + "pt";
            }
        }
    </script>
</body>
</html>
